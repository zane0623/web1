"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_copilot-chat_components_Chat_tsx"],{39742:(e,t,s)=>{s.d(t,{r:()=>eg});var n,a=s(74848),i=s(46988),r=s(38568),o=s(38621),l=s(75177),c=s(63867),d=s(55847),m=s(84217),u=s(52464),h=s(30729),x=s(96540),p=s(2120),g=s(82610),f=s(93589),j=s(2622),y=s(65615),b=s(7426),v=s(56212),C=s(47173);let N={legalText:"Chat-module__legalText--wsTEU"};var A=s(22937),_=s(78176),k=s(56056),S=s(26871),w=s(72160),R=s(8338);let E=({suggestionKind:e})=>{let t=(0,y.Pk)(),s=(0,b.b)(),n=(0,x.useCallback)(e=>{s.sendChatMessage({thread:s.getSelectedThread(t),content:e.prompt??e.question,intent:e.intent,modeOverride:e.mode,references:t.currentReferences,topic:t.currentTopic,context:t.context}),(0,i.BI)("copilot_generated_suggestion_click",{intent:e.intent,mode:e.mode,contextType:t.context?.[0]?.type,content:e.question})},[s,t]),r=(0,x.memo)(function({suggestion:e}){return(0,a.jsxs)(R.l.Item,{onSelect:()=>n(e),sx:{mx:0,border:"1px solid",borderColor:"border.default",width:"fit-content"},children:[(0,a.jsx)(R.l.LeadingVisual,{children:(0,a.jsx)(h.A,{icon:o.PaperAirplaneIcon})}),(0,a.jsxs)("span",{children:[" ",e.question]})]})}),l="loading"===t.messagesLoading.state||!!t.streamingMessage,{suggestions:c}=t,d=t.currentReferences[0],m=1===t.currentReferences.length&&d?.type==="repository"&&d.id===t.currentRepository?.id;return!l&&(j.W.topicsAsReferences?m:!t.showTopicPicker&&0===t.currentReferences.length)&&c&&c.suggestions?(0,a.jsxs)(R.l,{className:"copilot-suggestions",sx:{pt:0,pb:3,display:"flex",gap:2,flexDirection:"column"},children:["initial"===e&&(0,a.jsx)(R.l.Heading,{as:"h2",sx:{fontSize:0,mx:0,color:"fg.muted",fontWeight:600},children:function(e){return e?`Ask about the ${e.replace(/-/g," ")}:`:"Ask anything:"}(c.referenceType)}),c?.suggestions.map(e=>a.jsx(r,{suggestion:e},e.question))]}):null},I=(0,x.memo)(E);try{E.displayName||(E.displayName="CopilotSuggestions")}catch{}try{(n=CopilotSuggestion).displayName||(n.displayName="CopilotSuggestion")}catch{}var T=s(97891),M=s(89401),z=s(88117),B=s(10871),P=s(87330);let W={container:"CustomBanner-module__container--uV55s",expanded:"CustomBanner-module__expanded--fDTFJ",actions:"CustomBanner-module__actions--tUuz0",iconButton:"CustomBanner-module__iconButton--WWgYX",content:"CustomBanner-module__content--xhiU7",icon:"CustomBanner-module__icon--WrRHA"};function D({icon:e,content:t,actions:s,onDismiss:n}){let i=(0,x.useRef)(null),[r,l]=(0,x.useState)(!1);return(0,x.useEffect)(()=>{let e=i.current;if(!e)return;let t=new ResizeObserver(t=>{for(let s of t)s.target===e&&(s.contentRect.height>40?l(!0):l(!1))});return t.observe(e),()=>{t.disconnect()}},[]),(0,a.jsxs)("div",{ref:i,className:`${W.container} ${r?W.expanded:""}`,children:[(0,a.jsx)("div",{className:W.icon,children:e}),(0,a.jsx)("div",{className:W.content,children:t}),(0,a.jsxs)("div",{className:W.actions,children:[s,n&&(0,a.jsx)(P.K,{className:W.iconButton,variant:"invisible",icon:o.XIcon,size:"medium","aria-label":"Close",onClick:n})]})]})}try{D.displayName||(D.displayName="CustomBanner")}catch{}function F(){let{resetDate:e}=(0,z.x)(),t=(0,a.jsx)(o.InfoIcon,{}),s=(0,a.jsxs)(a.Fragment,{children:["You have reached your free plan limit. It will reset on ",e]}),n=(0,a.jsx)(B.z,{as:"a",href:"https://github.com/features/copilot#pricing",onClick:()=>{(0,i.BI)("dotcom_chat.activate",{target:"QUOTA_EXCEEDED_BANNER_LINK_UPGRADE",mode:"assistive"})},children:"Upgrade"});return(0,a.jsx)(D,{icon:t,content:s,actions:n})}try{F.displayName||(F.displayName="QuotaExceededBanner")}catch{}var L=s(34614);let U={container:"QuotaExceededEmptyState-module__container--ZMWEG",main:"QuotaExceededEmptyState-module__main--g2hJz",hero:"QuotaExceededEmptyState-module__hero--IrY09",copy:"QuotaExceededEmptyState-module__copy--VyrMt",heading:"QuotaExceededEmptyState-module__heading--LzJGU",description:"QuotaExceededEmptyState-module__description--KbMyl",footer:"QuotaExceededEmptyState-module__footer--evZ9_"};function $(){let{resetDate:e}=(0,z.x)();return(0,a.jsxs)("div",{className:U.container,children:[(0,a.jsxs)("div",{className:U.main,children:[(0,a.jsx)("img",{className:U.hero,src:"/images/modules/copilot-immersive-v1/hero.png",alt:"Hero"}),(0,a.jsxs)("div",{className:U.copy,children:[(0,a.jsx)("h2",{className:U.heading,children:"You\u2019ve reached your free plan limit"}),(0,a.jsxs)("p",{className:U.description,children:["Your limits will reset on ",e,"."]}),(0,a.jsx)(B.z,{as:"a",variant:"primary",href:"https://github.com/features/copilot#pricing",onClick:()=>{(0,i.BI)("dotcom_chat.activate",{target:"QUOTA_EXCEEDED_EMPTY_STATE_LINK_UPGRADE",mode:"assistive"})},children:"Upgrade"})]})]}),(0,a.jsxs)("div",{className:U.footer,children:[(0,a.jsx)("strong",{children:"Part of an organization?"}),(0,a.jsxs)("span",{children:["Upgrade to"," ",(0,a.jsx)(L.A,{href:"https://github.com/github-copilot/business_signup/choose_business_type?cft=copilot_li.features_copilot.cfb",inline:!0,children:"Copilot Business"})," ","to enable across teams."]})]})]})}try{$.displayName||($.displayName="QuotaExceededEmptyState")}catch{}var G=s(37937);let Q={container:"QuotaMeterBanner-module__container--QJsKZ"};function O(){let{isLicensedLimited:e,chatQuotaRemaining:t}=(0,z.x)(),[s,n]=(0,x.useState)(()=>G.J.getMeterBannerFlag()??!1);if((0,x.useEffect)(()=>{if(e&&void 0!==t){let e=G.J.getMeterBannerFlag();t>0&&t<=10?null===e?(G.J.setMeterBannerFlag(!0),n(!0)):n(e):(G.J.removeMeterBannerFlag(),n(!1))}},[e,t]),!s||void 0===t)return null;let r=(0,a.jsx)(o.InfoIcon,{}),l=(0,a.jsx)(a.Fragment,{children:"You only have a few free responses remaining."}),c=(0,a.jsx)(B.z,{as:"a",href:"https://github.com/features/copilot#pricing",onClick:()=>{(0,i.BI)("dotcom_chat.activate",{target:"QUOTA_METER_BANNER_LINK_UPGRADE",mode:"assistive"})},children:"Upgrade"});return(0,a.jsx)("div",{className:Q.container,children:(0,a.jsx)(D,{icon:r,content:l,actions:c,onDismiss:()=>{G.J.setMeterBannerFlag(!1),n(!1)}})})}try{O.displayName||(O.displayName="QuotaMeterBanner")}catch{}var q=s(10967);function J(){let{currentTopic:e}=(0,y.Pk)(),t=(0,g.P)(e),s=(0,g.Z6)(e),n=null;e&&s&&(n=`${e.ownerLogin}/${e.name}`);let i=t?e.repos:n?[n]:[],[r,o]=(0,q.M8)(i),l=r.requestStatus===q.xG.CanIndex&&(s&&r.code===q.W5.Unindexed||t&&r.docs===q.W5.Unindexed),c=(0,x.useRef)(!1);return(0,x.useEffect)(function(){let e=t?r.docs:r.code;!c.current&&e===q.W5.Unindexed&&l&&(c.current=!0,o())},[r.code,r.docs,t,l,o]),(0,a.jsx)(a.Fragment,{})}try{J.displayName||(J.displayName="TopicIndexedMessage")}catch{}var K=s(31806);function V(){let{currentTopic:e}=(0,y.Pk)(),t=(0,y.pn)(e=>e.currentReferences.find(e=>"docset"===e.type)),s=e??t,n=(0,x.useRef)(null);return s?(0,a.jsx)(K.Z,{icon:(0,a.jsx)(o.RepoIcon,{}),topic:s,removeButtonRef:n}):null}try{V.displayName||(V.displayName="TopicIndicator")}catch{}var Y=s(70642),H=s(8932);function Z({mode:e}){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{sx:{height:"3rem",mb:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(H.A,{})}),(0,a.jsx)(m.A,{as:"h1",sx:{textAlign:"center",fontSize:3,mb:2},children:"Ask Copilot"}),(0,a.jsx)(u.A,{as:"p",sx:{textAlign:"center",color:"fg.muted",mb:"immersive"===e?5:3,px:3,textWrap:"balance"},children:"Select a repository to get started. Ask questions about your codebase to get answers fast and learn your way around."})]})}try{Z.displayName||(Z.displayName="ChatWithCopilotHeader")}catch{}var X=s(62456);function ee({docset:e,size:t}){return(0,a.jsx)(X.r,{src:e.avatarUrl,square:"organization"===e.ownerType,size:t})}try{ee.displayName||(ee.displayName="KnowledgeBaseAvatar")}catch{}var et=s(70170),es=s(67138),en=s(91189),ea=s(96558),ei=s(59010);function er(){let e=(0,b.b)(),{currentRepository:t,mode:s,selectedThreadID:n}=(0,y.Pk)(),[i,r]=(0,x.useState)(""),d=(0,et.s)(e=>r(e),400,{start:!1}),[m,h]=(0,x.useState)(void 0),p=(0,x.useCallback)(()=>h(void 0),[]),g=(0,x.useCallback)(async t=>{if(p(),void 0===t){e.showTopicPicker(!1),e.clearCurrentTopic(),e.clearCurrentReferences(),"immersive"===s&&window.history.pushState(null,"","/copilot"),n&&G.J.setSelectedTopic(n,null);return}await e.fetchCurrentRepo(Number(t)),e.showTopicPicker(!1)},[p,e,s,n]),{repositories:f,loading:j}=(0,en.U)(i,m,h,!0,t,4),v=(0,x.useMemo)(()=>j?"Loading repositories":0===f.length?"No repositories found":1===f.length?"1 repository found":`${f.length} repositories found`,[j,f.length]);return(0,a.jsxs)(l.A,{sx:{border:"1px solid var(--borderColor-default, var(--color-border-default))",borderRadius:2,display:"flex",flexDirection:"column",mb:3},children:[(0,a.jsx)(l.A,{sx:{p:3,pb:0},children:(0,a.jsx)(es.A,{id:ea.uN,leadingVisual:o.SearchIcon,name:"topic-search","aria-label":"Search repositories to chat about",placeholder:"Search repositories to chat about",onChange:e=>d(e.target.value),sx:{width:"100%","input:placeholder-shown":{textOverflow:"ellipsis"}}})}),(0,a.jsxs)(R.l,{children:[(0,a.jsx)("div",{role:"status",className:"sr-only",children:v}),j?(0,a.jsx)(l.A,{as:"li",sx:{display:"flex",justifyContent:"center",py:2,height:"190px",alignItems:"center"},children:(0,a.jsx)(c.A,{})}):0===f.length?(0,a.jsxs)(R.l.Item,{disabled:!0,children:[(0,a.jsx)(R.l.LeadingVisual,{sx:{color:"fg.muted"},children:(0,a.jsx)(o.CircleSlashIcon,{})}),(0,a.jsx)(u.A,{sx:{color:"fg.muted"},children:"No results found"})]}):(0,a.jsx)(a.Fragment,{children:f.length>0&&(0,a.jsxs)(R.l.Group,{children:[(0,a.jsx)(R.l.GroupHeading,{as:"h3",children:"Recent repositories"}),f.map(e=>(0,a.jsx)(ei.W,{repo:e,onSelect:g,trailingVisualComponent:(0,a.jsx)(o.ArrowRightIcon,{})},e.nwo))]})}),(0,a.jsx)(R.l.Divider,{sx:{marginInline:0}}),(0,a.jsxs)(R.l.Item,{id:"chat-with-no-context",onSelect:()=>g(void 0),sx:{"#chat-with-no-context--label":{marginBottom:"0px !important"}},children:["General purpose chat",(0,a.jsx)(R.l.TrailingVisual,{children:(0,a.jsx)(o.ArrowRightIcon,{})})]},"chat-with-no-context")]})]})}try{er.displayName||(er.displayName="TopicList")}catch{}let eo=()=>{let e=(0,y.Pk)(),t=(0,x.useMemo)(()=>e.ssoOrganizations?e.ssoOrganizations.map(e=>e.login):[],[e.ssoOrganizations]);return(0,a.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",flexGrow:1,height:"100%"},children:(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[(0,a.jsx)(Z,{mode:e.mode}),(0,a.jsx)(l.A,{sx:{px:3,"> button":{m:"0 auto"}},children:(0,a.jsx)(er,{})}),(0,a.jsx)(Y.x,{portalContainerName:M.E5,protectedOrgs:t,redirectURI:()=>`/search/refresh_blackbird_caches?return_to=${location.href}`,sx:{mx:3,mb:3}}),(0,a.jsx)(el,{currentTopic:e.currentTopic})]})})};function el({currentTopic:e}){return(0,g.P)(e)?(0,a.jsx)(l.A,{sx:{mt:3,mb:4},children:(0,a.jsx)(ec,{docset:e})}):null}function ec({docset:e}){return(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",gap:3,border:"1px solid var(--borderColor-default, var(--color-border-default))",borderRadius:"var(--borderRadius-large)",padding:3},children:[(0,a.jsxs)(l.A,{sx:{display:"flex",alignItems:"baseline",gap:2},children:[(0,a.jsx)(ee,{docset:e,size:24}),(0,a.jsx)(m.A,{as:"h3",sx:{fontSize:1,m:0},children:e.name})," ",(0,a.jsx)(u.A,{sx:{fontSize:0,color:"fg.muted"},children:"Knowledge base added to conversation"})]}),(0,a.jsx)(m.A,{as:"h4",sx:{fontSize:0,m:0,color:"fg.muted",fontWeight:"500"},children:"Repositories in this knowledge base"}),(0,a.jsx)(l.A,{sx:{display:"flex",flexWrap:"wrap",gap:3},children:e.repos.map(e=>(0,a.jsxs)(l.A,{sx:{whiteSpace:"nowrap"},children:[(0,a.jsx)(o.RepoIcon,{}),` ${e}`]},e))})]})}try{eo.displayName||(eo.displayName="TopicPicker")}catch{}try{el.displayName||(el.displayName="TopicDescription")}catch{}try{ec.displayName||(ec.displayName="DocsetDescription")}catch{}let ed=({messages:e,inputRef:t,showQuotaExceededEmptyState:s})=>{let n=(0,y.Pk)(),{showTopicPicker:i,streamingMessage:o}=n,c="immersive"===n.mode,{scrollToBottom:d}=(0,S.b)(),m=(0,f.B)(e);n.streamingMessage&&m.push(n.streamingMessage),(0,r.N)(()=>d("instant"),[d]);let u=(0,k.A)(m);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:"sr-only",children:"Copilot Chat"}),s?(0,a.jsx)($,{}):i?(0,a.jsx)(eo,{}):(0,a.jsx)(l.A,{sx:{display:"flex",flexDirection:"column",minHeight:"0",flexGrow:1},children:(0,a.jsxs)(l.A,{className:"copilot-messages-container",sx:{display:"flex",flexDirection:"column",flexGrow:1},children:[0===m.length&&(0,a.jsx)("p",{className:N.legalText,children:(0,a.jsx)(T.h,{})}),!c&&!j.W.topicsAsReferences&&(0,a.jsx)(J,{}),u.map((e,s)=>(0,a.jsx)(k.i,{isLastGroup:s===u.length-1,children:e.map((i,r)=>{let l=s===u.length-1&&r===e.length-1;return(!em(i)||!j.W.dotcomChatClientSideSkills||i.error||eh(i,m,l,n))&&(0,a.jsx)(_.c,{isLatestMessage:l,isFirstReply:1===m.length,isStreaming:i.id===o?.id,message:i,inputRef:t},r)})},s)),n.clientSkillConfirmation&&j.W.dotcomChatClientSideSkills&&(0,a.jsx)("div",{className:"m-3",children:(0,a.jsx)(w.m,{confirmation:n.clientSkillConfirmation,handleConfirmation:e=>n.clientSkillConfirmation?.onSubmit?.("accepted"===e.state),isLatestMessage:!0})})]})})]})},em=e=>!e.content&&(!e.confirmations||0===e.confirmations.length)&&(!e.clientConfirmations||0===e.clientConfirmations.length),eu=e=>e.clientSkillsRequests&&e.clientSkillsRequests.length>0||e.clientToolResults&&e.clientToolResults.length>0,eh=(e,t,s,n)=>eu(e)&&s&&!n.streamingMessage&&!n.clientSkillConfirmation,ex=()=>(0,a.jsxs)(l.A,{sx:{m:"auto",display:"flex",flexDirection:"column",alignItems:"center",height:"100%",justifyContent:"center"},children:[(0,a.jsx)(c.A,{size:"large"}),(0,a.jsx)(l.A,{sx:{p:3,color:"fg.subtle"},children:"Loading conversation\u2026"})]}),ep=()=>{let{mode:e,reviewLab:t}=(0,y.Pk)();return(0,a.jsxs)(l.A,{sx:{display:"flex",gap:"2",alignItems:"center",py:3,pr:3,pl:"immersive"===e?3:2,color:"fg.subtle"},children:[(0,a.jsx)(h.A,{icon:o.AlertIcon}),"Failed to load previous messages.",t&&(0,a.jsx)(a.Fragment,{children:"\xa0You are in a review lab. Please check that you are connected to the Developer VPN."})]})},eg=({inputRef:e})=>{let t=(0,y.Pk)(),s=(0,b.b)(),{currentReferences:n,messagesLoading:r,messagesRestored:o,threadsLoading:c,currentTopic:d,messages:m,mode:u,selectedThreadID:h,showTopicPicker:N,context:_}=t,k=s.getSelectedThread(t),w=(0,x.useMemo)(()=>(0,g.k4)(Object.keys(v.Pe)).slice(0,4).map(e=>({heading:e,content:(0,g.k4)(v.Pe[e])[0]})),[]),{textAreaRef:R}=(0,p.Y)(e),{chatQuotaExceeded:E,isLicensedLimited:T,reloadQuota:B}=(0,z.x)(),{ambientError:P}=(0,y.Pk)();(0,x.useEffect)(()=>{if(!h||"assistive"===u)return;let e=`${g.Jz}/c/${h}`;window.location.pathname!==e&&0!==m.length&&history.pushState(null,"",e)},[h,u,m.length]);let W=(0,x.useCallback)(async e=>{""!==e.trim()&&(B(),await s.sendChatMessage({thread:k,content:e,references:n,topic:d,context:_,customInstructions:t.customInstructions}))},[_,n,d,s,B,t.customInstructions,k]),D=o&&m.length>0,L="loading"===r.state&&t.selectedThreadID&&!N&&!D,U="error"===r.state||"error"===c.state,$="loaded"===r.state||D,G=E&&(N||!k),[Q]=(0,x.useState)(t.renderAttachKnowledgeBaseHerePopover),q=(0,f.B)(m),J=!!(!L&&!t.currentTopic&&!N&&0===q.length&&!Q&&0===n.length);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S.$,{className:"copilot-chat-messages",style:{flex:"1 1 auto"},children:[L&&(0,a.jsx)(ex,{}),U&&(0,a.jsx)(ep,{}),$&&!L&&(0,a.jsx)(ed,{...t,inputRef:R,showQuotaExceededEmptyState:G}),(0,a.jsx)(M.Cb,{})]}),J&&(0,a.jsx)(l.A,{className:"copilot-chat-messages",sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,px:3,mb:3,scrollbarGutter:"stable"},children:w.map((e,n)=>(0,a.jsx)(ef,{heading:e.heading,content:e.content,onSubmit:()=>{s.sendChatMessage({thread:s.getSelectedThread(t),content:e.content,references:t.currentReferences,topic:t.currentTopic,context:t.context}),(0,i.BI)("copilot_chat_suggestion_click",{topic:t.currentTopic?.name})}},n))}),!L&&!N&&!G&&(0,a.jsx)(l.A,{className:"copilot-chat-input copilot-chat-input-outer",sx:{display:"flex",flexDirection:"column",mt:"auto",px:3,pb:3,zIndex:1},children:E?(0,a.jsx)(F,{}):(0,a.jsxs)(a.Fragment,{children:[!J&&0===q.length&&!t.showTopicPicker&&(0,a.jsx)(I,{suggestionKind:"initial"}),(0,a.jsxs)("div",{children:[T&&(0,a.jsx)(O,{}),P&&(0,a.jsx)(C.P,{ambientError:P}),!j.W.topicsAsReferences&&(0,a.jsx)(V,{}),(0,a.jsx)(A.V,{textAreaRef:R,onSubmit:W,isStreaming:!!t.streamingMessage,size:"small"},h)]})]})}),(0,a.jsx)(M.zc,{})]})};function ef({heading:e,content:t,onSubmit:s}){return(0,a.jsxs)(d.Q,{sx:{bg:"canvas.default",height:"auto",minWidth:"auto",borderBottom:"1px solid",borderColor:"border.default",border:"1px solid var(--borderColor-default, var(--color-border-default))",flex:"1 1 49%",display:"flex",flexDirection:"column",justifyContent:"center",p:2},onClick:s,children:[(0,a.jsx)(m.A,{as:"h3",sx:{textAlign:"center",fontSize:1,m:0,mb:1,wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:e}),(0,a.jsx)(u.A,{as:"p",sx:{fontSize:0,fontWeight:400,textAlign:"center",color:"fg.muted",m:0,textWrap:"balance",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},children:t})]})}try{ed.displayName||(ed.displayName="Messages")}catch{}try{ex.displayName||(ex.displayName="Loading")}catch{}try{ep.displayName||(ep.displayName="Error")}catch{}try{eg.displayName||(eg.displayName="Chat")}catch{}try{ef.displayName||(ef.displayName="SuggestedPrompt")}catch{}},78176:(e,t,s)=>{s.d(t,{c:()=>z});var n=s(74848),a=s(15294),i=s(26514),r=s(62456),o=s(46988),l=s(34407),c=s(53949),d=s(38621),m=s(75177),u=s(52464),h=s(20053),x=s(96540),p=s(89151),g=s(82610),f=s(2622),j=s(65615),y=s(7426),b=s(1088),v=s(79929),C=s(72659),N=s(66349),A=s(72160),_=s(67264),k=s(61982),S=s(47920),w=s(32132),R=s(79887),E=s(82005),I=s(4181),T=s(50260);let M=({isLatestMessage:e,isFirstReply:t,isStreaming:s,...M})=>{let{message:z}=(0,C.V)(),B=(0,j.Pk)(),P=(0,y.b)(),{author:W,handleConfirmationAction:D,handleRetryErrorMessage:F,hasClientConfirmations:L,isAI:U,isCopilot:$,isError:G,isAgentError:Q,isInterrupted:O,isLoading:q,isUser:J,myRef:K,onFeedbackSubmitted:V,renderContentArea:Y,rendererConfig:H,renderFeedback:Z,shouldShowMessageActions:X,skillExecutionToUseForRespondingText:ee,showRetryButton:et}=(0,p.p)({excludeFeedback:M.excludeFeedback,inputRef:M.inputRef,isLatestMessage:e,isLoading:M.isLoading,isStreaming:s,excludeReferencesFromFocusZone:!0}),es=z.clientToolResults&&z.clientToolResults.length>0,en=z.clientSkillsRequests&&z.clientSkillsRequests.length>0,ea=J&&!es,ei=q||es||en,er=ei&&e,eo=$||es,el=z.references?.filter(e=>N._().has(e.type)),ec=P.maxMessagesReached(),ed=z.mediaContent?.find(e=>e.mediaType.startsWith("image/")),em=f.W.attachImagesImmersive&&void 0!==ed||!1,eu=(0,x.useCallback)(e=>{let t=e.target.href,s=z.references?.find(e=>e.url===t);s&&"immersive"===B.mode&&(P.selectReference(s),e.preventDefault())},[P,z.references,B.mode]);return(0,n.jsxs)("div",{className:(0,h.$)("message-container",v.A.messageContainer,ea&&v.A.user,U&&v.A.ai),ref:K,...(0,c.G)(`message-${G?"error":s?"streaming":z.id}`),children:[ea&&em&&(0,n.jsx)(b.o,{src:ed?.url||"",alt:"Uploaded image"}),eo||es?(0,n.jsx)(_.W,{isLoading:ei&&e,isError:G&&z.error?.type!=="agentUnauthorized",mode:B.mode,isFirstMessage:t,isLoadingSkills:(z.skillExecutions??[]).length>0&&ei&&""===z.content&&e,message:z.content||"",createdAt:z.createdAt}):U?(0,n.jsx)("div",{className:v.A.avatar,children:(0,n.jsx)(r.r,{src:W.avatarURL,size:24,"aria-label":`${W.name} avatar`,alt:`${W.name} avatar`,"data-testid":"chat-message-author-avatar"})}):null,ea&&(0,n.jsx)(N.t2,{size:"small",align:"right",className:"mb-2",references:z.references??[]}),(0,n.jsxs)("div",{className:(0,h.$)(v.A.message,ea&&v.A.user),children:[L&&z.clientConfirmations?.length?(0,n.jsx)(m.A,{className:"my-1",sx:{display:"flex",alignItems:"baseline",justifyContent:ea?"flex-end":""},"data-testid":"chat-message-client-confirmations",children:(0,n.jsxs)(u.A,{sx:{fontWeight:"normal",color:"var(--fgColor-muted)"},children:[(0,n.jsx)(d.CheckIcon,{})," ",W.name," ",z.clientConfirmations?.[0]?.state," the action"]})}):null,$&&er&&ee&&(0,n.jsx)(T.b,{className:(0,h.$)(v.A.skillExecutionText,"mb-2 mt-1 ml-2"),children:`${(0,w.WA)(ee)}...`}),(0,n.jsxs)("div",{className:(0,h.$)(v.A.messageContent,!!L&&v.A.hasClientConfirmations),children:[eo&&e&&!Y?(0,n.jsx)("span",{className:v.A.blinkingCursor,children:"\u258B"}):null,Y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(m.A,{className:"js-snippet-clipboard-copy-unpositioned",sx:{fontSize:1,px:2,py:1,zIndex:1,".snippet-clipboard-content":{position:"relative",overflow:"auto",display:"flex",justifyContent:"space-between",backgroundColor:"canvas.subtle",marginBottom:3,zIndex:1,pre:{marginBottom:0},"clipboard-copy":{width:"28px",height:"28px"}}},children:["assistant"===z.role&&(el?.length?(0,n.jsx)(N.sV,{className:"mb-3",references:z.references??[]}):null),$&&M.isLoading?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.O,{variant:"rounded",height:"12px",width:"random"}),(0,n.jsx)(l.O,{variant:"rounded",height:"12px",width:"random"}),(0,n.jsx)(l.O,{variant:"rounded",height:"12px",width:"random"})]}):!L&&(ea?(0,n.jsx)(I.R,{children:z.content??""}):(0,n.jsx)(a.To,{markdown:z.content??"",onLinkClick:eu,chatMode:"assistive",...H})),G?(0,n.jsx)(k.K,{manager:P}):null,Q&&z.agentErrors?.length?(0,n.jsx)(k.h,{errors:z.agentErrors}):null,O?(0,n.jsx)(R.h,{messageHasContent:!!z.content||!!z.skillExecutions?.length}):null,($||(0,g.yh)(W))&&(0,g.Ye)(z.confirmations).map((t,s)=>"indexrepo"===t.confirmation.name?null:(0,n.jsx)(A.m,{confirmation:t,handleConfirmation:D,isLatestMessage:e},s))]}),!X&&et&&(0,n.jsx)(E.$,{handleRetryMessage:F,disabled:ec}),X&&(0,n.jsxs)(m.A,{className:"message-actions","data-testid":"message-action-bar",sx:{display:"inline-flex",alignItems:"center",position:e?void 0:"absolute",bottom:e?void 0:"-2.25rem",borderRadius:e?void 0:2,boxShadow:e?void 0:"var(--shadow-floating-small)",opacity:e?void 0:0,pointerEvents:e?void 0:"none","&::before":{content:e?void 0:'""',inset:"-0.5rem -0.75rem",zIndex:-1,position:"absolute"}},children:[Z&&(0,n.jsx)(S.G,{iconSize:"small",returnFocusRef:K,onFeedbackSubmitted:V}),$&&!!z.content&&!s&&(0,n.jsx)(i.T,{textToCopy:z.content??"",ariaLabel:"Copy to clipboard",size:"small",className:"d-flex flex-items-center",onCopy:()=>{(0,o.BI)("copilot_chat.activate",{target:"CHAT_MESSAGE_COPY",mode:B.mode})}}),et&&(0,n.jsx)(E.$,{handleRetryMessage:F,disabled:ec})]})]})]})]})]})},z=({message:e,...t})=>(0,n.jsx)(C.$,{message:e,children:(0,n.jsx)(M,{...t})});try{M.displayName||(M.displayName="InnerChatMessage")}catch{}try{z.displayName||(z.displayName="ChatMessage")}catch{}}}]);
//# sourceMappingURL=ui_packages_copilot-chat_components_Chat_tsx-bf9abad8f3ce.js.map